<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card text-center">
            <div class="card-header card-header-custom">
                <h2 class="card-title">Alarme</h2>
            </div>
            <div class="card-body card-body-custom card-body-alarm">
                <p class="lead">Defina um horário para o alarme:</p>
                <form id="alarm-form">
                    <div class="form-group">
                        <label for="alarm-time">Horário (HH:MM)</label>
                        <input type="time" id="alarm-time" class="form-control" required />
                    </div>
                    <button type="submit" class="btn btn-primary mt-2">Ativar Alarme</button>
                    <button id="cancel-alarm" class="btn btn-danger mt-2">Cancelar Alarme</button>
                    
                </form>
                <div id="alarm-message" class="alert alert-info mt-3 d-none">
                    <strong>Alarme definido!</strong> Você será notificado quando o horário for alcançado.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let alarmTime = null; // Horário do alarme
    let alarmTimeout; // Timeout do alarme

// Configura o alarme
document.getElementById("alarm-form").addEventListener("submit", (e) => {
    e.preventDefault();
    const alarmInput = document.getElementById("alarm-time").value;
    if (alarmInput) {
        alarmTime = alarmInput; // Exemplo: "14:30"
        document.getElementById("alarm-message").classList.remove("d-none");
        document.getElementById("alarm-message").textContent = `Alarme definido para ${alarmTime}.`;
        checkAlarm(); // Inicia a verificação do alarme
    }
});

// Cancela o alarme
document.getElementById("cancel-alarm").addEventListener("click", () => {
    alarmTime = null;
    clearTimeout(alarmTimeout);
    document.getElementById("alarm-message").classList.add("d-none");
});

// Verifica se o horário atual corresponde ao alarme
function checkAlarm() {
    if (!alarmTime) return;

    const now = new Date();
    const currentTime = now.toTimeString().slice(0, 5); // HH:MM
    console.log(`Horário atual: ${currentTime}, Alarme: ${alarmTime}`); // Debug

    if (currentTime === alarmTime) {
        alert("⏰ O alarme está tocando!");
        playAlarmSound(); // Toca o som do alarme
        alarmTime = null; // Reseta o alarme
        document.getElementById("alarm-message").classList.add("d-none");
        return;
    }

    // Continua verificando a cada 1 segundo
    alarmTimeout = setTimeout(checkAlarm, 1000);
}

// Reproduz um som
function playAlarmSound() {
    const alarmSound = new Audio("/assets/alarme.mp3");
    alarmSound.play().catch((error) => {
        console.error("Erro ao tocar o som:", error);
        alert("⏰ O som do alarme não pode ser reproduzido. Verifique as configurações do navegador.");
    });
}
</script>